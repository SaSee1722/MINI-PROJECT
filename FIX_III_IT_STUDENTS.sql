-- ============================================
-- FIX III IT STUDENTS - UPDATE TO CORRECT CLASS
-- ============================================
-- This script updates specific students from II IT to III IT class
-- Run this in Supabase SQL Editor

-- Step 1: Verify III IT class exists
SELECT id, name, stream_id 
FROM classes 
WHERE name = 'III IT' AND stream_id = 'cse';

-- Step 2: Check current assignments (before update)
SELECT 
  s.roll_number,
  s.name,
  c.name as current_class
FROM students s
JOIN classes c ON s.class_id = c.id
WHERE s.roll_number IN (
  '713623205001',
  '713623205002',
  '713623205003',
  '713623205004',
  '713623205005',
  '713623205006',
  '713623205007',
  '713623205008',
  '713623205009',
  '713623205010',
  '713623205011',
  '713623205012',
  '713623205013',
  '713623205014',
  '713623205015',
  '713623205016',
  '713623205017',
  '713623205018',
  '713623205019',
  '713623205020',
  '713623205021',
  '713623205022',
  '713623205024',
  '713623205025',
  '713623205027',
  '713623205029',
  '713623205030',
  '713623205031',
  '713623205032',
  '713623205033',
  '713623205034',
  '713623205035',
  '713623205036',
  '713623205037',
  '713623205038',
  '713623205039',
  '713623205040',
  '713623205041',
  '713623205043',
  '713623205044',
  '713623205045',
  '713623205046',
  '713623205047',
  '713623205049',
  '713623205050',
  '713623205051',
  '713623205052',
  '713623205053',
  '713623205054',
  '713623205056',
  '713623205057',
  '713623205058',
  '713623205059',
  '713623205060',
  '713623205061',
  '713623205062',
  '713623205063',
  '713623205064',
  '713623205065',
  '713623205066',
  '713623205067'
)
AND s.stream_id = 'cse'
ORDER BY s.roll_number;

-- Step 3: UPDATE - Move students from II IT to III IT
UPDATE students
SET class_id = (
  SELECT id FROM classes 
  WHERE name = 'III IT' AND stream_id = 'cse' 
  LIMIT 1
)
WHERE roll_number IN (
  '713623205001',
  '713623205002',
  '713623205003',
  '713623205004',
  '713623205005',
  '713623205006',
  '713623205007',
  '713623205008',
  '713623205009',
  '713623205010',
  '713623205011',
  '713623205012',
  '713623205013',
  '713623205014',
  '713623205015',
  '713623205016',
  '713623205017',
  '713623205018',
  '713623205019',
  '713623205020',
  '713623205021',
  '713623205022',
  '713623205024',
  '713623205025',
  '713623205027',
  '713623205029',
  '713623205030',
  '713623205031',
  '713623205032',
  '713623205033',
  '713623205034',
  '713623205035',
  '713623205036',
  '713623205037',
  '713623205038',
  '713623205039',
  '713623205040',
  '713623205041',
  '713623205043',
  '713623205044',
  '713623205045',
  '713623205046',
  '713623205047',
  '713623205049',
  '713623205050',
  '713623205051',
  '713623205052',
  '713623205053',
  '713623205054',
  '713623205056',
  '713623205057',
  '713623205058',
  '713623205059',
  '713623205060',
  '713623205061',
  '713623205062',
  '713623205063',
  '713623205064',
  '713623205065',
  '713623205066',
  '713623205067'
)
AND stream_id = 'cse';

-- Step 4: Verify the update (after update)
SELECT 
  s.roll_number,
  s.name,
  c.name as class_name,
  s.stream_id
FROM students s
JOIN classes c ON s.class_id = c.id
WHERE s.roll_number IN (
  '713623205001',
  '713623205002',
  '713623205003',
  '713623205004',
  '713623205005',
  '713623205006',
  '713623205007',
  '713623205008',
  '713623205009',
  '713623205010',
  '713623205011',
  '713623205012',
  '713623205013',
  '713623205014',
  '713623205015',
  '713623205016',
  '713623205017',
  '713623205018',
  '713623205019',
  '713623205020',
  '713623205021',
  '713623205022',
  '713623205024',
  '713623205025',
  '713623205027',
  '713623205029',
  '713623205030',
  '713623205031',
  '713623205032',
  '713623205033',
  '713623205034',
  '713623205035',
  '713623205036',
  '713623205037',
  '713623205038',
  '713623205039',
  '713623205040',
  '713623205041',
  '713623205043',
  '713623205044',
  '713623205045',
  '713623205046',
  '713623205047',
  '713623205049',
  '713623205050',
  '713623205051',
  '713623205052',
  '713623205053',
  '713623205054',
  '713623205056',
  '713623205057',
  '713623205058',
  '713623205059',
  '713623205060',
  '713623205061',
  '713623205062',
  '713623205063',
  '713623205064',
  '713623205065',
  '713623205066',
  '713623205067'
)
AND s.stream_id = 'cse'
ORDER BY s.roll_number;

-- Step 5: Count students in III IT class
SELECT 
  c.name as class_name,
  COUNT(s.id) as student_count
FROM classes c
LEFT JOIN students s ON c.id = s.class_id
WHERE c.name = 'III IT' AND c.stream_id = 'cse'
GROUP BY c.name;

